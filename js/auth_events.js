!function(){"use strict";function e(e){return"[object Object]"===Object.prototype.toString.call(e)}function t(e){return"function"==typeof e}function n(){function e(e,t){return i[e]&&i[e].indexOf(t)!==-1}function n(n,o){i[n]=i[n]||[],t(o)&&!e(n,o)&&i[n].push(o)}function o(t,n){e(t,n)&&i[t].splice(i[t].indexOf(n),1)}function r(e,t){for(var n=arguments.length,o=Array(n>2?n-2:0),r=2;r<n;r++)o[r-2]=arguments[r];var a=window[b].storage;!e&&a&&["logout","login","oauthlogin"].indexOf(t)>-1&&a.postMessage({eventType:t,emitter:b},O),setTimeout(function(){i[t]&&i[t].forEach(function(e){return e.apply(void 0,o)})},10)}var i={};this.addListener=this.on=n,this.removeListener=this.off=o,this.emit=r}function o(e){t(e)&&e()}function r(e,t,n){var o=new XMLHttpRequest,r={method:e,params:[t],rpc:"2.0"};o.open("post",w,!0),o.setRequestHeader("Content-Type","application/json"),o.withCredentials=!0,o.onreadystatechange=function(){if(4===o.readyState&&200===o.status){var e=JSON.parse(o.responseText).result;n("OK"===e.status?e:null)}},o.send(JSON.stringify(r))}function i(e,n){var o=document.createElement("script");o.src=e,o.onload=function(){t(n)&&n(),document.body.removeChild(o)},document.body.appendChild(o)}function a(n,o){var i=o||n;r(C,e(n)?n:{},function(e){t(i)&&i(e?e.profile:e)})}function s(e){return/avatars\.rambler\.ru/.test(e)?e.replace(/\/default$/,"").replace(/\/get/,"/100x100"):e}function l(e){return e?{provider:e.display.avatar.provider,iconUrl:e.display.avatar.provider_icon,avatarUrl:s(e.display.avatar.url),shortName:e.display.short_name,displayName:e.display.display_name,mailboxExists:"general"===e.__type?1:0}:null}function c(e){a(function(n){t(e)&&e(l(n))})}function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments[1],o=n||e;r(x,{},function(){L.emit(!1,"logout",t(e)?null:e),t(o)&&o(null)})}function d(e,t){i(O+"/script/create_session.js?token="+e,t)}function f(e){i(O+"/script/exportsid.js",function(){t(e)&&e(RamblerId)})}function p(e){var t=document.createElement("iframe");t.src=O+"/rambler-id-helper/",t.style.width="0",t.style.height="0",t.style.border="0",t.style.position="absolute",t.style.left="-9999px",t.onload=function(){e(t.contentWindow)},document.body.appendChild(t)}function m(t){var n=t.data;e(n)&&n.emitter===b&&(["redirect","close"].indexOf(n.eventType)>=0?L.emit(n.internal,n.eventType,n.frameInfo,n.redirectUrl):L.emit(n.internal,n.eventType,n.data))}function g(){window.addEventListener("message",m,!1)}function y(e){return function(t){L.on(e,t)}}function v(e){return function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];L.emit.apply(L,[!1,e].concat(n))}}function h(){var n=window[b];e(n)||(window[b]={push:o,logout:u,getProfileInfo:a,getCurrentUserInfo:c,createSession:d,exportsid:f,registerOnFrameRedirect:y("redirect"),registerOnFrameCloseCallback:y("close"),registerOnPossibleLoginCallback:y("login"),registerOnPossibleOauthLoginCallback:y("oauthlogin"),registerOnPossibleLogoutCallback:y("logout"),emitLogin:v("login"),emitLogout:v("logout")},p(function(e){window[b].storage=e}),g()),Array.isArray(n)&&n.forEach(function(e){t(e)&&e()})}var b="ramblerIdHelper",O="https://id.rambler.ru",w=O+"/jsonrpc",C="Rambler::Id::get_profile_info",x="Rambler::Id::destroy_session",L=new n;document.body?h():document.addEventListener("DOMContentLoaded",h,!1)}();